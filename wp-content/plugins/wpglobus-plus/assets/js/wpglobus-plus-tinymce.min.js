jQuery(document).ready(function(a){"use strict";if("undefined"!=typeof WPGlobusPlusTinyMCE){if("wpglobus-plus-options"!=WPGlobusPlusTinyMCE.page||"tinymce"!=WPGlobusPlusTinyMCE.tab){if("undefined"==typeof WPGlobusCoreData)return;if("undefined"==typeof WPGlobusAdminApp)return}var i={dLang:WPGlobusCoreData.default_language,languageButtonClass:"widget btn wpglobus-plus-language-button",activeButtonClass:"active",currentLanguage:{},content:{},savedStatus:!1,debugMode:!1,settingsTab:"wpglobus-plus-options"==WPGlobusPlusTinyMCE.page&&"tinymce"==WPGlobusPlusTinyMCE.tab,startInitEditors:!1,submitElements:[],init:function(){i.settingsTab?i.initSettingsTab():(i.debugMode=WPGlobusAdminApp.App.prototype.parseBool(WPGlobusCoreData.page_custom_data.debugMode),"undefined"!=typeof tinymce&&(i.checkSubmitElements(),i.addButtons(),i.initEditors(),i.attachListeners()))},initSettingsTab:function(){a(document).on("click","#wpglobus-plus-add-item",function(t){var e=a("#wpglobus-plus-skeleton tbody tr").clone();a("#wpglobus-plus-tinymce-items tbody .no-items").hide(),a("#wpglobus-plus-tinymce-items tbody").append(e)}),a(document).on("click",".wpglobus-plus-action-ajaxify",function(t){t.preventDefault();var e=a(this);"remove"==e.data("action")&&e.parents("tr").fadeToggle("slow"),i.order={},i.order.action=WPGlobusPlusTinyMCE.module+"-"+e.data("action"),i.order.module=WPGlobusPlusTinyMCE.module,i.order.page=e.data("page"),i.order.key=e.data("key"),i.order.settings=WPGlobusPlusTinyMCE.settings,i.ajax(i.order).done(function(t){}).fail(function(t){}).always(function(t,e){})}),a(document).on("change",".wpglobus-plus-ajaxify",function(t){var e=a(this),n=e.parents("tr");i.order={},i.order.action=WPGlobusPlusTinyMCE.module+"-"+e.data("action"),i.order.module=WPGlobusPlusTinyMCE.module,i.order.page=n.find("input.page").val(),i.order.element=n.find("input.element").val(),i.order.key=e.data("key"),i.order.settings=WPGlobusPlusTinyMCE.settings,""!=i.order.page&&""!=i.order.element&&i.ajax(i.order).done(function(t){}).fail(function(t){}).always(function(t,e){})})},ajax:function(t,e){return a.ajax({beforeSend:function(){void 0!==e&&e()},type:"POST",url:ajaxurl,data:{action:WPGlobusPlusTinyMCE.process_ajax,order:t},dataType:"json"})},initEditors:function(){i.startInitEditors&&a(document).on("tinymce-editor-init",function(t,e){i.isExcluded(e.id)||(e.on("nodechange keyup",_.debounce(i.update,300)),a("#"+e.id).on("input keyup",_.debounce(i.update,300)))})},checkSubmitElements:function(){var n=null;void 0!==WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.pagenow]?n=WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.pagenow]:void 0!==WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.page]&&(n=WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.page]),null===n||(a.each(n,function(t,e){/^[#]|^[.]|^input\[name=/.test(e)||(n[t]='input[name="'+e+'"]'),0<a(n[t]).length&&(i.startInitEditors=!0)}),i.submitElements=n)},addButtons:function(){tinymce.PluginManager.add("wpglobus_globe",function(t,e){if(!i.isExcluded(t.id)){if(i.startInitEditors){i.content[t.id]=a("#"+t.id).val(),i.currentLanguage[t.id]=i.dLang;var n=WPGlobusCore.getTranslations(i.content[t.id]);a("#"+t.id).val(n[i.dLang]),_.delay(function(){a(t.iframeElement).addClass("wpglobus-translatable").css({width:"99%"}),a("#"+t.id).addClass("wpglobus-translatable")},2e3)}var o,u;u=i.startInitEditors?(o=i.debugMode?"Get editor ID":"","wpglobus-plus-globe"):(o=WPGlobusPlusTinyMCE.i18n.warning,"wpglobus-plus-red-globe"),t.addButton("wpglobus_globe",{text:"",icon:u,tooltip:o,onclick:function(){"wpglobus-plus-red-globe"==a(this)[0].settings.icon?window.open(WPGlobusPlusTinyMCE.settings.page,"_blank"):i.debugMode&&i.startInitEditors&&t.insertContent(t.id)}})}}),i.startInitEditors&&a.each(WPGlobusCoreData.enabled_languages,function(t,o){tinymce.PluginManager.add("wpglobus_language_button_"+o,function(t,e){if(!i.isExcluded(t.id)){var n=o==i.dLang?i.activeButtonClass:"";t.addButton("wpglobus_language_button_"+o,{text:o,icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[o]+" language",classes:i.languageButtonClass+" "+n+" wpglobus-plus-language-button-"+t.id+" wpglobus-plus-language-button-"+o,onclick:function(){t.execCommand("mceNewDocument"),t.execCommand("mceInsertContent",!1,WPGlobusCore.getTranslations(i.content[t.id])[o]),i.currentLanguage[t.id]=o,i.toggleButtonClass(t.id,o)}})}})})},toggleButtonClass:function(t,e){a(".mce-wpglobus-plus-language-button-"+t).removeClass("mce-active"),a(".mce-wpglobus-plus-language-button-"+t+".mce-wpglobus-plus-language-button-"+e).addClass("mce-active")},attachListeners:function(){i.startInitEditors&&a.each(i.submitElements,function(t,e){if(0==e.length)return!0;a(document).on("mouseenter",e,function(t){a.each(i.content,function(t,e){null==tinymce.get(t)||tinymce.get(t).isHidden()?(a("#"+t).val(e),a("#"+t+"-tmce").click()):tinymce.get(t).setContent(e,{format:"raw"})})}).on("mouseleave",e,function(t){i.savedStatus||a.each(i.content,function(t,e){e=WPGlobusCore.getTranslations(i.content[t])[i.currentLanguage[t]];null==tinymce.get(t)||tinymce.get(t).isHidden()?a("#"+t).val(e):tinymce.get(t).setContent(e,{format:"raw"})})}).on("click",e,function(t){i.savedStatus=!0})})},update:function(t){var e,n;void 0!==t.target&&("tinymce"==(e=t.target.id)&&(e=t.target.dataset.id),void 0!==i.content[e]&&(n=null==tinymce.get(e)||tinymce.get(e).isHidden()?a("#"+e).val():tinymce.get(e).getContent({format:"raw"}),i.content[e]=WPGlobusCore.getString(i.content[e],n,i.currentLanguage[e])))},isExcluded:function(n){if(void 0===n)return!1;if(-1!=a.inArray(n,WPGlobusPlusTinyMCE.excluded))return!0;var o=!1;return a.each(WPGlobusPlusTinyMCE.excludedMask,function(t,e){if(-1!=n.indexOf(e))return!(o=!0)}),o}};WPGlobusPlusTinyMCE=a.extend({},WPGlobusPlusTinyMCE,i),WPGlobusPlusTinyMCE.init()}});