!function(l){"use strict";if("undefined"!=typeof WPGlobusCoreData&&"undefined"!=typeof WPGlobusPlusAcf){var i={option:{language:WPGlobusCoreData.default_language,content:"",activeClass:"mce-active"},language:{},content:{},disabledEditor:!1,acfPro:!1,savedPost:!1,__getContent:function(){"object"==typeof WPGlobusPlusAcf.content&&l.each(WPGlobusPlusAcf.content,function(t,e){console.log("content of: ",t),console.log(e)})},isAcfPro:function(){return i.acfPro},parseBool:function(t){return!/^(false|0)$/i.test(t)&&!!t},initWysiwygWithBuilder:function(t){tinymce.PluginManager.add("wpglobus_plus_acf_separator",function(t,e){if((0<=t.id.indexOf("wysiwyg-acf-field")||0<=t.id.indexOf("acf-editor-"))&&"function"==typeof WPGlobusAcf.registerField){var n=WPGlobusAcf.registerField(l("#"+t.id).attr("name"));WPGlobusAcf.isDisabledField(n)&&(i.disabledEditor=!0)}i.isDisabledEditor()||t.addButton("wpglobus_plus_acf_separator",{text:"",icon:"wpglobus-plus-globe"})}),tinymce.PluginManager.add("wpglobus_plus_acf_button_"+WPGlobusAdmin.builder.language,function(t,e){if("content"!=t.id&&-1!=t.id.indexOf("acf-")){_.delay(function(){l(t.iframeElement).addClass("wpglobus-translatable").css({width:"99%"}),l("#"+t.id).addClass("wpglobus-translatable")},2e3),t.addButton("wpglobus_plus_acf_button_"+WPGlobusAdmin.builder.language,{text:WPGlobusCoreData.en_language_name[WPGlobusAdmin.builder.language],icon:!1,tooltip:"Current language",value:WPGlobusAdmin.builder.language,classes:"widget btn wpglobus-plus-acf-button active wpglobus-plus-acf-button-"+WPGlobusAdmin.builder.language+" wpglobus-plus-acf-button-"+t.id,onclick:function(){}})}})},init:function(t){i.option=l.extend(i.option,t),"undefined"!=typeof WPGlobusAcf&&(i.acfPro=i.parseBool(WPGlobusAcf.pro)),"undefined"!=typeof WPGlobusAdmin&&void 0!==WPGlobusAdmin.builder&&WPGlobusAdmin.builder.builder_page?i.initWysiwygWithBuilder():!1!==i.addButtons()&&(i.isAcfPro()?l(document).on("wpglobus_before_save_post",function(t,e){i.savedPost||(i.savedPost=!0,l.each(i.content,function(t,e){null==tinymce.get(t)||tinymce.get(t).isHidden()?(l("#"+t).val(e),l("#"+t+"-tmce").click()):tinymce.get(t).setContent(e,{format:"raw"})}))}):(i.setValidation(),void 0===acf.validation.disabled?l(document).on("wpglobus_before_save_post",function(t,e){l.each(i.content,function(t,e){tinymce.get(t).setContent(e)})}):l(document).on("wpglobus_before_save_post",function(t,e){acf.validation.disabled||acf.validation.run(),acf.validation.status&&l.each(i.content,function(t,e){tinymce.get(t).setContent(e)})})),i.editorsInit())},update:function(t){var e,n;void 0!==t.target&&("tinymce"==(e=t.target.id)&&(e=t.target.dataset.id),void 0!==i.content[e]&&(n=null==tinymce.get(e)||tinymce.get(e).isHidden()?l("#"+e).val():tinymce.get(e).getContent({format:"raw"}),i.content[e]=WPGlobusCore.getString(i.content[e],n,i.language[e])))},editorsInit:function(){i.acfPro&&l(document).on("tinymce-editor-init",function(t,e){-1!=e.id.indexOf("acf-editor-")&&(e.on("nodechange keyup",_.debounce(i.update,1e3)),l("#"+e.id).on("input keyup",_.debounce(i.update,1e3)))})},setValidation:function(){acf.validation.disabled||l(document).on("acf/validate_field",function(t,e){var n,a=l(e),o="",i=!0;if(a.hasClass("field_type-textarea"))a.data("validation",!1),n=a.find("textarea").attr("id"),o=l("#"+n).val();else{if(!a.hasClass("field_type-text"))return;a.data("validation",!1),n=a.find("input").attr("id"),o=l("#"+n).val()}""!=o&&(o=WPGlobusCore.getTranslations(o),l.each(WPGlobusCoreData.enabled_languages,function(t,e){if(""==o[e])return i=!1;i=!0}),i?(a.data("validation",!0),l("#wpglobus-dialog-start-"+n).removeClass("wpglobus_dialog_error")):l("#wpglobus-dialog-start-"+n).addClass("wpglobus_dialog_error").shake(3,7,800))})},saveContent:function(t,e){var n;n=WPGlobusPlusAcf.removeEmptyP?t.getContent().replace(/<p>\s*<\/p>/g,""):t.getContent(),i.content[t.id]=WPGlobusCore.getString(i.content[t.id],n,e)},getTranslation:function(t,e){return WPGlobusCore.getTranslations(i.content[t.id])[e]},removeClass:function(t){l(".mce-wpglobus-plus-acf-button-"+t).removeClass(i.option.activeClass)},initContent:function(t){var a=l("#"+t.id).text(),o=WPGlobusCore.getTranslations(a);l.each(o,function(t,e){if(t!==WPGlobusCoreData.default_language){var n=o[t].split("\n\n");l.each(n,function(t,e){""!==e&&(n[t]="<p>"+e+"</p>")}),o[t]=n.join(""),a=WPGlobusCore.getString(a,o[t],t)}}),i.content[t.id]=a},isDisabledEditor:function(){return i.disabledEditor},addButtons:function(){i.disabledEditor=!1,tinymce.PluginManager.add("wpglobus_plus_acf_separator",function(t,e){if((0<=t.id.indexOf("wysiwyg-acf-field")||0<=t.id.indexOf("acf-editor-"))&&"function"==typeof WPGlobusAcf.registerField){var n=WPGlobusAcf.registerField(l("#"+t.id).attr("name"));WPGlobusAcf.isDisabledField(n)&&(i.disabledEditor=!0)}i.isDisabledEditor()||t.addButton("wpglobus_plus_acf_separator",{text:"",icon:"wpglobus-plus-globe"})}),l.each(WPGlobusCoreData.enabled_languages,function(t,n){tinymce.PluginManager.add("wpglobus_plus_acf_button_"+n,function(a,t){var e="";if(0<=a.id.indexOf("wysiwyg-acf-field")||0<=a.id.indexOf("acf-editor-")){if("function"==typeof WPGlobusAcf.registerField&&WPGlobusAcf.isDisabledField(l("#"+a.id).attr("name")))return!1;n==WPGlobusCoreData.default_language&&(_.delay(function(){l(a.iframeElement).addClass("wpglobus-translatable").css({width:"99%"}),l("#"+a.id).addClass("wpglobus-translatable")},2e3),i.initContent(a),i.language[a.id]=i.option.language,l("#"+a.id).val(i.getTranslation(a,n)),e=" active",a.on("blur",function(t,e){i.saveContent(a,i.language[a.id])}))}a.addButton("wpglobus_plus_acf_button_"+n,{text:WPGlobusCoreData.en_language_name[n],icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[n]+" language",value:n,classes:"widget btn wpglobus-plus-acf-button"+e+" wpglobus-plus-acf-button-"+n+" wpglobus-plus-acf-button-"+a.id,onclick:function(){var t=l(this),e=t[0]._id,n=WPGlobusCoreData.default_language;void 0!==t[0]._value?n=t[0]._value:void 0!==t[0].settings.value?n=t[0].settings.value:console.log("Language value not defined. It was set to default."),i.removeClass(a.id),l("#"+e).addClass(i.option.activeClass),i.saveContent(a,i.language[a.id]),i.language[a.id]=n,a.setContent(i.getTranslation(a,i.language[a.id]))}})})})}};WPGlobusPlusAcf=l.extend({},WPGlobusPlusAcf,i),WPGlobusPlusAcf.init()}}(jQuery);